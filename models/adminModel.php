<?phpclass adminModel extends Model {    public function __construct() {        parent::__construct();    }    public function Update($id, $tabla, $columna, $param) {        $dat = $this->_db->query("UPDATE $tabla SET $columna='{$param}' WHERE id='{$id}'");    }    public function UpdateUserName($id, $tabla, $columna, $result) {        $dat = $this->_db->query("UPDATE $tabla SET $columna='{$result}' WHERE id='{$id}'");    }    public function resetearPass($id) {        $id = $id;        $this->_db->prepare(                        "UPDATE usuarios SET password=:password WHERE id=:id"                )                ->execute(array(                    "id" => $id,                    ":password" => HASH::getHash(HASH_ALGORITMO, PASSWORD_RESET, HASH_KEY),        ));    }    public function UpdateTracks($id, $columna, $result) {        $dat = $this->_db->query("UPDATE tb_tracks SET $columna='{$result}' WHERE id='{$id}'");    }    public function viewTraksModal($cart, $idVentas) {        ?>        <table class="table table-hover">            <thead>                <tr>                    <th>Your song</th>                    <th style="text-align: center;">Version</th>                    <th style="text-align: center;">Pitch</th>                    <th style="text-align: center;"></th>                </tr>            </thead>            <tbody>                <?php                for ($i = 0; $i < count($cart['cart']); $i++) :                    ?>                    <?php                    $da = $cart['cart'][$i];                    $datas = $this->GetCheckoutDemo($da['MP3Demo']);                    ?>                    <tr>                        <td><?= $datas[0]['name'] . " - " . $datas[0]['artist_name'] . ""; ?></td>                        <td style="text-align: center;"><?= ucfirst($this->GetTypeText($da['tipo'])); ?></td>                        <td style="text-align: center;"><?= $da['pitch']; ?></td>                        <td style="text-align: center;">                            <?php if ($data[0]['estado'] == "PAGADO"): ?>                                <?php                                if ($da['pitch'] > 0) {                                    $pitch = $this->GetPitch($da['pitch']);                                    $ex = explode(".mp3", $da['MP3Demo']);                                    $ruta = "modules/usuarios/ftp/$usuario/order_$order/$ex[0]$pitch.mp3";                                    $mp3 = "$ex[0]$pitch.mp3";                                } else {                                    $ruta = "modules/usuarios/ftp/$usuario/order_$order/" . $da['MP3Demo'];                                    $mp3 = $da['MP3Demo'];                                }                                if (Functions::checkFiles($ruta)) {//                                     data-name="<?= $datas[0]['name'] . " - " . $datas[0]['artist_name'] . " - " . $da->tipo . " - $da->pitch";"                                    ?>                                    <span>                                        <form method="POST" target="_BLANCK" class="download-agent" action="<?= BASE_URL . "download/" ?>">                                            <input type="hidden" name="order" value="<?= "order_" . $order; ?>">                                            <input type="hidden" name="download" value="<?= $mp3 ?>">                                            <input type="hidden" name="user" value="<?= $usuario ?>">                                            <input type="hidden" name="name" value="<?= $datas[0]['name']; ?>">                                            <input type="hidden" name="artist_name" value="<?= $datas[0]['artist_name']; ?>">                                            <input type="hidden" name="tipo" value="<?= $da['tipo']; ?>">                                            <input type="hidden" name="pitch" value="<?= "pitch" . $da['pitch'] . "" . ".mp3"; ?>">                                            <input type="submit" value="Download">                                        </form>                                    </span>                                    <?php                                } else {                                    ?>                                    The file doesn't exist                                    Click here to send a report                                    <?php                                }                                ?>                            <?php else: ?>                                Pending                            <?php endif; ?>                        </td>                    </tr>                    <?php                    for ($x = 0; $x < count($cart['cart'][$i]['version']); $x++):                        ?>                        <?php                        $version = $json['cart'][$i]['version'][$x];                        $datas = $this->GetCheckoutDemo($version['cancion']);                        $ruta = "modules/usuarios/ftp/$usuario/order_$order/$version->cancion";                        if (!empty($version)) {                            ?>                            <tr>                                <td><?= $datas[0]['name'] . "(" . $datas[0]['artist_name'] . ")"; ?></td>                                <td style="text-align: center;"><?= ucfirst($this->GetTypeText($version['version'])); ?></td>                                <td style="text-align: center;"><?= $version['pitch']; ?></td>                                <td style="text-align: center;">                                    <?php if ($data[0]['estado'] == "PAGADO"): ?>                                        <?php                                        if (Functions::checkFiles($ruta)) {                                            if ($version['pitch'] > 0) {                                                $pitch = $this->GetPitch($version['pitch']);                                                $ex2 = explode(".mp3", $version['cancion']);                                                $ruta = "modules/usuarios/ftp/$usuario/order_$order/$ex2[0]$pitch.mp3";                                                $mp3 = "$ex2[0]$pitch.mp3";                                            } else {                                                $ruta = "modules/usuarios/ftp/$usuario/order_$order/" . $version['cancion'];                                                $mp3 = $version['cancion'];                                            }                                            ?>                                            <span>                                                <form method="POST" target="_BLANCK" class="download-agent" action="<?= BASE_URL . "download/" ?>">                            <!--                                            <a target="_BLANCK" class="download-agent" data-order="<?= "$order" ?>" data-download="<?= $mp3 ?>">Download</a>-->                                                    <input type="hidden" name="order" value="<?= "order_" . $order; ?>">                                                    <input type="hidden" name="download" value="<?= $mp3 ?>">                                                    <input type="hidden" name="user" value="<?= $usuario ?>">                                                    <input type="hidden" name="name" value="<?= $datas[0]['name']; ?>">                                                    <input type="hidden" name="artist_name" value="<?= $datas[0]['artist_name']; ?>">                                                    <input type="hidden" name="version" value="<?= $version['tipo']; ?>">                                                    <input type="hidden" name="pitch" value="<?= "pitch" . $version['pitch'] . ".mp3"; ?>">                                                    <input type="submit" value="Download">                                                </form>                                            </span>                                            <?php                                        } else {                                            ?>                                            The file doesn't exist                                            Click here to send a report                                            <?php                                        }                                        ?>                                    <?php else: ?>                                        Pending                                    <?php endif; ?>                                </td>                            </tr>                            <?php                        }                        ?>                        <?php                    endfor;                endfor;                ?>            </tbody>        </table>        <?php    }    public function GetTypeText($type) {        $datos = array(            "GT" => "no guitars",            "WV" => "WB/vocals",            "BASS" => "no bass",            "FV" => "full version",            "" => "full version",        );        if (array_key_exists($type, $datos)) {            return $datos[$type];        } else {            return $type;        }    }    /**     * Get Pitch 1,2,3,4,-1,-2,-3,-4. Y lo devolvemos con '-' si es +1,+2,+3,+4 o '_' si es -1,-2,-3,-4     * @param type $pitch     * @return string     */    public function GetPitch($pitch) {        switch ($pitch) {            case "1": $pitchs = 100;                $type = "_1";                break;            case "2": $pitchs = 200;                $type = "_2";                break;            case "3": $pitchs = 300;                $type = "_3";                break;            case "4": $pitchs = 400;                $type = "_4";                break;            case "-1": $pitchs = -100;                $type = "-1";                break;            case "-2": $pitchs = -200;                $type = "-2";                break;            case "-3": $pitchs = -300;                $type = "-3";                break;            case "-4": $pitchs = -400;                $type = "-4";                break;        }        return $type;    }    public function GetCheckoutDemo($demo) {        $sql = "SELECT * FROM tb_tracks WHERE `demo` = :demo LIMIT 1";        $q = $this->_db->prepare($sql);        $q->execute(array(':demo' => $demo));        $resp = $q->fetchAll(PDO::FETCH_ASSOC);        return $resp;    }    public function BloquedUsuarios($id, $bloq) {        $bloq = (int) $bloq;        echo $bloq;        $this->_db->query("UPDATE usuarios SET estado='{$bloq}' WHERE id='{$id}'");    }    public function ActivarOrden($id, $email, $usuario) {        $id = (int) $id;        $this->_db->query("UPDATE ventas SET estado='PAGADO',caducidad=0,payer_status='verified',payment_status='Completed' WHERE id_ventas='{$id}'");        $to = $email;        $subject = 'You order from superbackings.com';        // Cabecera que especifica que es un HMTL        $headers = 'MIME-Version: 1.0' . "\r\n";        $headers .= 'Content-type: text/html; charset=iso-8859-1' . "\r\n";// Cabeceras adicionales//            $headers .= "From: \"" . "Superbackings" . "\" <" . "superbackingtracks@gmail.com" . ">\n";        $headers .= "From: sales@superbackings.com" . "\r\n" . "Sender:sales@superbackings.com";//            $cabeceras .= 'Cc: archivotarifas@example.com' . "\r\n";//            $cabeceras .= 'Bcc: copiaoculta@example.com' . "\r\n";        $cuerpo = '<html>     <head>        <title>' . $subject . '</title>    </head>     <body>     <p><img src="https://www.superbackings.com/views/layout/superbackings/img/logosuperemail.png" width="400" height="60" /></p>    <p class="designemail"><strong>Hello</strong>, ' . $usuario . ', Thanks for your payment. Your order is ready to be downloaded.<br><br>Thank you very much!</p>    <a href="' . BASE_URL . 'usuarios/panel/">Click here to acces to your Customer panel</a>    <p class="designemail">Best Regards</p>    <p class="designemail">The superbackings Team<br>    <a href="https://www.superbackings.com">www.superbackings.com</a></p>            </body>            </html>            ';        mail($to, $subject, $cuerpo, $headers);    }    public function generateCodePromocional() {        $bd = $this->_db;        $code = Functions::generateRandomString(50);        $data = $bd->prepare("SELECT * FROM codigoPromocional WHERE codigo='{$code}'");        $dato = $data->fetchAll(PDO::FETCH_OBJ);        $count = count($dato);        if ($count == 0) {            $codig = $code;        } else {            $codes = null;            while ($count != 0) {                $code = Functions::generateRandomString(50);                $datos = $bd->prepare("SELECT * FROM codigoPromocional WHERE codigo='{$code}'");                $dato = $datos->fetchAll(PDO::FETCH_OBJ);                $count = count($dato);            }        }        $bd = null;        return $code;    }}?>